#!/bin/bash -e

GIT_ROOT="$(git rev-parse --show-toplevel)"
GO_ROOT="$GIT_ROOT/go"

SUMMARY_FILE="$GIT_ROOT/SUMMARY.md"

if [ -f "$SUMMARY_FILE" ]; then
  rm "$SUMMARY_FILE"
fi

echo "# Summary
" >>"$SUMMARY_FILE"

echo "## Go
" >>"$SUMMARY_FILE"

for part in $(find "$GO_ROOT" -mindepth 2 -maxdepth 2 -type d -name "part*" | sort); do
  echo "### Module $(realpath -s --relative-to "$GO_ROOT" "$part")

\`\`\`" >>"$SUMMARY_FILE"

  pushd "$part"
  timeGo >>"$SUMMARY_FILE" 2>&1
  popd >/dev/null

  echo "\`\`\`
" >>"$SUMMARY_FILE"
done

cat "$SUMMARY_FILE"
